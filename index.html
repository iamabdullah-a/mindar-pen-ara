<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

  <!-- A-Frame -->
  <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>

  <!-- AR.js -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>

  <title>WebAR Product Preview</title>

  <style>
    body { margin: 0; overflow: hidden; background: #000; }
    .hint {
      position: fixed;
      bottom: 16px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.65);
      color: #fff;
      padding: 10px 16px;
      border-radius: 10px;
      font-family: system-ui, sans-serif;
      font-size: 14px;
      z-index: 10;
    }
  </style>
</head>

<body>

  <div class="hint">Point camera at the marker · Drag to rotate · Pinch to zoom</div>

  <a-scene
    embedded
    arjs="sourceType: webcam; trackingMethod: best; debugUIEnabled: false;"
    renderer="antialias: true; colorManagement: true;"
  >

    <!-- Marker -->
    <a-marker
      preset="hiro"
      smooth="true"
      smoothCount="10"
      smoothTolerance="0.01"
      smoothThreshold="5"
    >

      <!-- Touch controls wrapper -->
      <a-entity
        id="model-wrapper"
        position="0 0.05 0"
        rotation="-90 0 180"
        scale="0.05 0.05 0.05"
        gesture-handler
      >

        <!-- Your 3D Model -->
        <a-entity
          gltf-model="assets/pen_free_download.glb"
        ></a-entity>

      </a-entity>

    </a-marker>

    <!-- Camera -->
    <a-entity camera></a-entity>

  </a-scene>

  <!-- Gesture Handler (rotate + zoom) -->
  <script>
    AFRAME.registerComponent('gesture-handler', {
      schema: {
        enabled: { default: true }
      },

      init: function () {
        this.handleScale = this.handleScale.bind(this);
        this.handleRotation = this.handleRotation.bind(this);

        this.initialScale = this.el.object3D.scale.clone();
        this.scaleFactor = 1;
      },

      handleScale: function (event) {
        this.scaleFactor *= event.detail.scale;
        this.el.object3D.scale.set(
          this.initialScale.x * this.scaleFactor,
          this.initialScale.y * this.scaleFactor,
          this.initialScale.z * this.scaleFactor
        );
      },

      handleRotation: function (event) {
        this.el.object3D.rotation.y += event.detail.positionChange.x * 0.01;
      },

      tick: function () {
        if (!this.data.enabled) return;

        this.el.sceneEl.addEventListener('onefingermove', this.handleRotation);
        this.el.sceneEl.addEventListener('twofingermove', this.handleScale);
      }
    });
  </script>

</body>
</html>
